<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="tinywars.css">
  <title>Tiny Wars Lite</title>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
  
</head>

<body>
  <h1>Tiny Wars Lite</h1>

  <!-- Notifications -->
  <div id="notifications" style="color: green;"></div>

  <!-- Resources Section -->
  <section>
    <h2>Resources</h2>
    <div>Wood: <span id="wood">0</span></div>
    <div>Stone: <span id="stone">0</span></div>
    <div>Gold: <span id="gold">0</span></div>
  </section>

  <!-- Buildings Section -->
  <section>
    <h2>Buildings</h2>

    <!-- Lumber Mill -->
    <div>
      <h3>Lumber Mill</h3>
      <p>Level: <span id="lumber-level">1</span></p>
      <p>Generates: <span id="lumber-rate">1</span> wood/second</p>
      <p>Upgrade Cost: <span id="lumber-cost">50</span> wood</p>
      <button onclick="upgradeBuilding('lumber')">Upgrade Lumber Mill</button>
    </div>

    <!-- Quarry -->
    <div>
      <h3>Quarry</h3>
      <p>Level: <span id="quarry-level">1</span></p>
      <p>Generates: <span id="quarry-rate">1</span> stone/second</p>
      <p>Upgrade Cost: <span id="quarry-cost">50</span> stone</p>
      <button onclick="upgradeBuilding('quarry')">Upgrade Quarry</button>
    </div>

    <!-- Gold Mine -->
    <div>
      <h3>Gold Mine</h3>
      <p>Level: <span id="gold-level">1</span></p>
      <p>Generates: <span id="gold-rate">1</span> gold/second</p>
      <p>Upgrade Cost: <span id="gold-cost">50</span> gold</p>
      <button onclick="upgradeBuilding('gold')">Upgrade Gold Mine</button>
    </div>
  </section>

  <!-- Script -->
  <script src="tinywars.js"></script>

  <!-- Firebase Initialization and Script -->
  <script>
    // Your Firebase config (replace with your actual Firebase config details)
    const firebaseConfig = {
      apiKey: "AIzaSyAPD0OqY3e6y3tbOT_cSKtUn-lNfO2KGyI",
      authDomain: "pigeonplaygamesonline.firebaseapp.com",
      projectId: "pigeonplaygamesonline",
      storageBucket: "pigeonplaygamesonline.firebasestorage.app",
      messagingSenderId: "172163872711",
      appId: "1:172163872711:web:47af2e8e9c11d288bc0be2",
      measurementId: "G-YB2Q3G3QZ3"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const auth = firebase.auth();

    // Sign in anonymously
    auth.signInAnonymously()
      .then(() => {
        console.log("Player logged in anonymously");
      })
      .catch((error) => {
        console.error("Authentication failed:", error);
      });

    // Listen for authentication state changes
    auth.onAuthStateChanged((user) => {
      if (user) {
        console.log("User ID:", user.uid);
        loadProgress(user.uid);  // Load user progress from Firebase
      }
    });

    // Game state (to be saved and loaded from Firebase)
    let gameState = {
      resources: {
        wood: 0,
        stone: 0,
        gold: 0
      },
      buildings: {
        lumber: 1,
        quarry: 1,
        gold: 1
      },
      score: 0
    };

    // Save game progress to Firebase
    function saveProgress(userId) {
      const userRef = database.ref('users/' + userId + '/gameState');
      userRef.set(gameState)
        .then(() => console.log("Progress saved!"))
        .catch((error) => console.error("Error saving progress:", error));
    }

    // Load game progress from Firebase
    function loadProgress(userId) {
      const userRef = database.ref('users/' + userId + '/gameState');
      userRef.once("value")
        .then((snapshot) => {
          if (snapshot.exists()) {
            gameState = snapshot.val();
            updateUI();
            console.log("Game state loaded:", gameState);
          } else {
            console.log("No saved game state found.");
          }
        })
        .catch((error) => {
          console.error("Error loading progress:", error);
        });
    }

    // Upgrade building function (generic for all buildings)
    function upgradeBuilding(building) {
      let resource = building === 'lumber' ? 'wood' : building === 'quarry' ? 'stone' : 'gold';
      let cost = building === 'lumber' ? gameState.buildings.lumber * 50 : building === 'quarry' ? gameState.buildings.quarry * 50 : gameState.buildings.gold * 50;

      if (gameState.resources[resource] >= cost) {
        gameState.resources[resource] -= cost;
        gameState.buildings[building]++;
        updateUI();
        saveProgress(firebase.auth().currentUser.uid);  // Save progress after upgrade
      } else {
        alert("Not enough " + resource + "!");
      }
    }

    // Update UI based on game state
    function updateUI() {
      document.getElementById('wood').textContent = gameState.resources.wood;
      document.getElementById('stone').textContent = gameState.resources.stone;
      document.getElementById('gold').textContent = gameState.resources.gold;
      document.getElementById('lumber-level').textContent = gameState.buildings.lumber;
      document.getElementById('lumber-rate').textContent = gameState.buildings.lumber;
      document.getElementById('lumber-cost').textContent = gameState.buildings.lumber * 50;
      document.getElementById('quarry-level').textContent = gameState.buildings.quarry;
      document.getElementById('quarry-rate').textContent = gameState.buildings.quarry;
      document.getElementById('quarry-cost').textContent = gameState.buildings.quarry * 50;
      document.getElementById('gold-level').textContent = gameState.buildings.gold;
      document.getElementById('gold-rate').textContent = gameState.buildings.gold;
      document.getElementById('gold-cost').textContent = gameState.buildings.gold * 50;
    }

    // Initial call to update UI
    updateUI();
  </script>
</body>

</html>
